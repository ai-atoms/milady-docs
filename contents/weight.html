<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimization of hyperparameters &mdash; Milady  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/fav.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced options" href="ml/advanced.html" />
    <link rel="prev" title="Databases" href="ml/database.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install/installation.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/installation.html#compilation-modes">Compilation modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/installation.html#build">Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/install_marconi.html">Build on Marconi</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/install_irene.html">Build on Irene</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration and usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ml/input.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/model.html">ML tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/model.html#regression-models">Regression models</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/kernels.html">Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/system.html">Atomic systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/descriptors.html">Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/database.html">Databases</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimization of hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/advanced.html">Advanced options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Milady</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Optimization of hyperparameters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/contents/weight.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimization-of-hyperparameters">
<h1>Optimization of hyperparameters<a class="headerlink" href="#optimization-of-hyperparameters" title="Permalink to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This option is not fully tested.  In case of weird results, you can share your experience and report an issue.</p>
</div>
<p>The weights of the various componenets in the database can be optimized,
using a <strong>genetic algorithm</strong>, through the following objective function:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = f_e \textrm{MAE}_e (\mathbf{w})+ f_f \textrm{MAE}_f (\mathbf{w})+ f_s \textrm{MAE}_s(\mathbf{w})
\label{eq:ga_opt}\]</div>
<p>MAE is the mean average error for energy, force or stress and <span class="math notranslate nohighlight">\(f\)</span>
is the multiplicative factor for each of them. These multiplicative
factors are provided by the user (see below in this section). The
optimization of weights are activated through
<code class="docutils literal notranslate"><span class="pre">optimize_weights=.true.</span></code> option and can be customized by 5 optional
commands.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights">
<span id="cmdoption-arg-optimize-weights"></span><span class="sig-name descname"><span class="pre">optimize_weights</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights" title="Permalink to this definition"></a></dt>
<dd><p>Activate or not the optimization through genetical algorithm.</p>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights=.false.</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-class_no_optimize_weights">
<span id="cmdoption-arg-class-no-optimize-weights"></span><span class="sig-name descname"><span class="pre">class_no_optimize_weights</span></span><span class="sig-prename descclassname"> <span class="pre">(character(len=90))</span></span><a class="headerlink" href="#cmdoption-arg-class_no_optimize_weights" title="Permalink to this definition"></a></dt>
<dd><p>The classes (with the same names / numbers as in <code class="docutils literal notranslate"><span class="pre">db_file</span></code>) for which the the
optimization through genetical algorithm is no activated . If there
are many classes, theirs names should be separated by space (see
the default value for an example)
This option is active only if <code class="docutils literal notranslate"><span class="pre">optimize_weights=.true.</span></code>
Example: <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights=&quot;</span> <span class="pre">02</span> <span class="pre">06</span> <span class="pre">&quot;</span></code> - no optimization
for the classes <code class="docutils literal notranslate"><span class="pre">02</span></code> and <code class="docutils literal notranslate"><span class="pre">06</span></code>.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights=&quot;</span> <span class="pre">&quot;</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_ga_population">
<span id="cmdoption-arg-optimize-ga-population"></span><span class="sig-name descname"><span class="pre">optimize_ga_population</span></span><span class="sig-prename descclassname"> <span class="pre">(integer)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_ga_population" title="Permalink to this definition"></a></dt>
<dd><p>The size of the population of  genetical algorithm.</p>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_ga_puplation=80</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-0">
<span class="sig-name descname"><span class="pre">optimize_weights</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-0" title="Permalink to this definition"></a></dt>
<dd><p>Activate or not the optimization through genetical algorithm.</p>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights=.false.</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_L1">
<span id="cmdoption-arg-optimize-weights-l1"></span><span class="sig-name descname"><span class="pre">optimize_weights_L1</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_L1" title="Permalink to this definition"></a></dt>
<dd><p>The regularization is performed
by adding a <span class="math notranslate nohighlight">\(L^1\)</span> function on the objective function from
Eq.<a class="reference external" href="#eq:ga_opt">[eq:ga_opt]</a>. The weigths are optimized in the
same time as the <code class="docutils literal notranslate"><span class="pre">lambda_krr</span></code> regularizitation parameter. The new
objective function becomes:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = J(\mathbf{w}) + \lambda_{krr} \sum_k \left|  w_k \right|\]</div>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_L1=.false.</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_L2">
<span id="cmdoption-arg-optimize-weights-l2"></span><span class="sig-name descname"><span class="pre">optimize_weights_L2</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_L2" title="Permalink to this definition"></a></dt>
<dd><p>The regularization is performed
by adding a <span class="math notranslate nohighlight">\(L^2\)</span> function on the objective function from
Eq.<a class="reference external" href="#eq:ga_opt">[eq:ga_opt]</a>. The weigths are optimized in the
same time as the <code class="docutils literal notranslate"><span class="pre">lambda_krr</span></code> regularizitation parameter. The new
objective function becomes:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = J(\mathbf{w}) + \lambda_{krr} \sum_k \left|  w_k \right|^2\]</div>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_L1=.false.</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_Le">
<span id="cmdoption-arg-optimize-weights-le"></span><span class="sig-name descname"><span class="pre">optimize_weights_Le</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_Le" title="Permalink to this definition"></a></dt>
<dd><p>The regularization is performed
by adding a <span class="math notranslate nohighlight">\(L^2\)</span> + <span class="math notranslate nohighlight">\(L^1\)</span> function on the objective
function from Eq.<a class="reference external" href="#eq:ga_opt">[eq:ga_opt]</a>. The weigths are
optimized in the same time as the <code class="docutils literal notranslate"><span class="pre">lambda_krr</span></code> regularizitation
parameter. The new objective function becomes:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = J(\mathbf{w}) + \lambda_{krr} \sum_k \left|  w_k \right|^2 + \lambda_{krr} \sum_k \left|  w_k \right|\]</div>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_Le=.false.</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-max_iter_optimize_weights">
<span id="cmdoption-arg-max-iter-optimize-weights"></span><span class="sig-name descname"><span class="pre">max_iter_optimize_weights</span></span><span class="sig-prename descclassname"> <span class="pre">(integer)</span></span><a class="headerlink" href="#cmdoption-arg-max_iter_optimize_weights" title="Permalink to this definition"></a></dt>
<dd><p>The maximum number of optimization steps</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">max_iter_optimize_weights=40</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-factor_energy_error">
<span id="cmdoption-arg-factor-energy-error"></span><span class="sig-name descname"><span class="pre">factor_energy_error</span></span><span class="sig-prename descclassname"> <span class="pre">(real)</span></span><a class="headerlink" href="#cmdoption-arg-factor_energy_error" title="Permalink to this definition"></a></dt>
<dd><p>The factor for energy in the
objective function (<span class="math notranslate nohighlight">\(f_e\)</span> in the
Eq. <a class="reference external" href="#eq:ga_opt">[eq:ga_opt]</a>).</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">force_energy_error=1.d0</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-factor_force_error">
<span id="cmdoption-arg-factor-force-error"></span><span class="sig-name descname"><span class="pre">factor_force_error</span></span><span class="sig-prename descclassname"> <span class="pre">(real)</span></span><a class="headerlink" href="#cmdoption-arg-factor_force_error" title="Permalink to this definition"></a></dt>
<dd><p>The factor for force in the
objective function (<span class="math notranslate nohighlight">\(f_f\)</span> in the
Eq. <a class="reference external" href="#eq:ga_opt">[eq:ga_opt]</a>).
Default: <code class="docutils literal notranslate"><span class="pre">force_force_error=1.d0</span></code></p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-factor_stress_error">
<span id="cmdoption-arg-factor-stress-error"></span><span class="sig-name descname"><span class="pre">factor_stress_error</span></span><span class="sig-prename descclassname"> <span class="pre">(real)</span></span><a class="headerlink" href="#cmdoption-arg-factor_stress_error" title="Permalink to this definition"></a></dt>
<dd><p>The factor for energy in the
objective function (<span class="math notranslate nohighlight">\(f_s\)</span> in the
Eq. <a class="reference external" href="#eq:ga_opt">[eq:ga_opt]</a>).</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">force_stress_error=1.d0</span></code></p>
</dd></dl>

<p>This option is active only if the option <code class="docutils literal notranslate"><span class="pre">optimize_weights=.true.</span></code> in
the in <code class="docutils literal notranslate"><span class="pre">name.ml</span></code> file. Each line of the DB file, <code class="docutils literal notranslate"><span class="pre">db_model.in</span></code>,
activate, by default, the weigths optimization. The <span class="math notranslate nohighlight">\(l^{th}\)</span> line
from <code class="docutils literal notranslate"><span class="pre">db_model.in</span></code> introduce three weigths that will be optimized,
<span class="math notranslate nohighlight">\(w^l_e\)</span>, <span class="math notranslate nohighlight">\(w^l_f\)</span> and <span class="math notranslate nohighlight">\(w^l_s\)</span> that stand for the
weights for energy, force and stress, respectivelly. Potentially, the
maximum value of number of weights (the number of arguments of the
genetic algorithm function) is equal to the number of lines of the DB
file, <code class="docutils literal notranslate"><span class="pre">db_model.in</span></code>), times three. However, this can be lower, using
the option <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights</span></code> we can exclude some lines. E.g.
by putting <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights=&quot;</span> <span class="pre">02</span> <span class="pre">06</span> <span class="pre">&quot;</span></code> all the lines that
belong to the class <code class="docutils literal notranslate"><span class="pre">02</span></code> and <code class="docutils literal notranslate"><span class="pre">06</span></code> will be excluded from
optimization.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ml/database.html" class="btn btn-neutral float-left" title="Databases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ml/advanced.html" class="btn btn-neutral float-right" title="Advanced options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MCM, AMG &amp; more.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>