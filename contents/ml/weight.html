<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimization of hyperparameters &mdash; Milady Docs</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/fav.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced options" href="advanced.html" />
    <link rel="prev" title="Databases" href="database.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation with Docker</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/docker.html">Pull the image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/docker.html#usage">Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build Milady</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/download.html">Download sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/installation.html">Local build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_irene.html">Build on Irene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_marconi.html">Build on Marconi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_milady-lammps.html">MILADY potentials in Lammps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="input.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">ML tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html#regression-models">Regression models</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernels.html">Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="system.html">Atomic systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="descriptors.html">Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Databases</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimization of hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/01_ex_write.html">Compute and write descriptors without further fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/02_ex_lmlfe.html">LML fit in bcc Fe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/03_ex_qnmlhea.html">QNML fit in HEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/04_ex_kernel.html">Kernel regression using polynomial kernel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Publications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pubs/publications.html">Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pubs/potentials.html">Potentials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Milady</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Optimization of hyperparameters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/contents/ml/weight.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimization-of-hyperparameters">
<span id="sec-hyper"></span><h1>Optimization of hyperparameters<a class="headerlink" href="#optimization-of-hyperparameters" title="Permalink to this heading"></a>
</h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This option is not fully tested.  In case of weird results, you can share your experience and report an issue.</p>
</div>
<p>The weights of the various components in the database can be optimized using a <strong>genetic algorithm</strong> through the following objective function:</p>
<div class="math notranslate nohighlight" id="equation-ga-opt">
<span class="eqno">(1)<a class="headerlink" href="#equation-ga-opt" title="Permalink to this equation"></a></span>\[J(\mathbf{w}) = f_e \textrm{MAE}_e (\mathbf{w})+ f_f \textrm{MAE}_f (\mathbf{w})+ f_s \textrm{MAE}_s(\mathbf{w})\]</div>
<p>MAE is the mean average error for energy, force, or stress, and <span class="math notranslate nohighlight">\(f\)</span> is the multiplicative factor for each of them.
These multiplicative factors are provided by the user (see below in this section).
The optimization of database weights is activated through the
<code class="docutils literal notranslate"><span class="pre">optimize_weights_db=.true.</span></code>. While the weights of chemical channels can be optimized by activation of the flag
<code class="docutils literal notranslate"><span class="pre">optimize_weights_chem=.true.</span></code>. Only one of them can be true, no crossed optimization for this <code class="docutils literal notranslate"><span class="pre">Milady</span></code> version.
The evolution of the objective function is monitorized in the file <code class="docutils literal notranslate"><span class="pre">optimization_error.dat</span></code> with the first column indicates
the call number, second: the objective function, third: <span class="math notranslate nohighlight">\(MAE_e\)</span>, fourth: <span class="math notranslate nohighlight">\(MAE_f\)</span> and fifth:  <span class="math notranslate nohighlight">\(MAE_s\)</span>.
At the end, the best set of parameters which corresponds to the best optimization, with a minimum of the objective
function, is given as output.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_db">
<span id="cmdoption-arg-optimize-weights-db"></span><span class="sig-name descname"><span class="pre">optimize_weights_db</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_db" title="Permalink to this definition"></a>
</dt>
<dd>
<p>You can activate or deactivate the optimization of weights <span class="math notranslate nohighlight">\(w_E\)</span>, <span class="math notranslate nohighlight">\(w_F\)</span>, and <span class="math notranslate nohighlight">\(w_S\)</span>
through a genetic algorithm. The initial and final values of these weights are indicated in
the <code class="docutils literal notranslate"><span class="pre">db_file</span></code> (usually named <code class="docutils literal notranslate"><span class="pre">db_model.in</span></code>).
For more information, please refer to the section on  <a class="reference internal" href="database.html#sec-db-model"><span class="std std-ref">Database files</span></a>.
The <span class="math notranslate nohighlight">\(l^{th}\)</span> line of <code class="docutils literal notranslate"><span class="pre">db_model.in</span></code> introduces three weights that will be
optimized: <span class="math notranslate nohighlight">\(w^l_e\)</span>, <span class="math notranslate nohighlight">\(w^l_f\)</span>, and <span class="math notranslate nohighlight">\(w^l_s\)</span>, which stand for the weights for energy,
force, and stress, respectively. The maximum number of weights
(the number of arguments of the genetic algorithm function) is equal to the number of lines
in the DB file, <code class="docutils literal notranslate"><span class="pre">db_model.in</span></code>, multiplied by three.
However, this number can be lower if you use the option <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights</span></code> to exclude some lines.
For example, if you put <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights="</span> <span class="pre">02</span> <span class="pre">06</span> <span class="pre">"</span></code>, all the lines that
belong to the classes <code class="docutils literal notranslate"><span class="pre">02</span></code> and <code class="docutils literal notranslate"><span class="pre">06</span></code> will be excluded from optimization.</p>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_db=.false.</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_chem">
<span id="cmdoption-arg-optimize-weights-chem"></span><span class="sig-name descname"><span class="pre">optimize_weights_chem</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_chem" title="Permalink to this definition"></a>
</dt>
<dd>
<p>Activate or not the optimization of the weights (or colors) of atoms in each channel through
genetical algorithm. The initial and final values of those weights are those selectioned in <code class="docutils literal notranslate"><span class="pre">ml</span></code> file.
How to activate or not the multi-channel descriptors for multiple elements databases can be found in
<a class="reference internal" href="system.html#sec-atomicsys"><span class="std std-ref">Atomic systems</span></a>. The result of the optimization can be found at screen of in the file
<code class="docutils literal notranslate"><span class="pre">optimization_chemical.info</span></code>.</p>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_chem=.false.</span></code></p>
</dd>
</dl>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This options  <code class="docutils literal notranslate"><span class="pre">optimize_weights_db</span></code> and <code class="docutils literal notranslate"><span class="pre">optimize_weights_chem</span></code> cannot be true simultaneously.</p>
</div>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-class_no_optimize_weights">
<span id="cmdoption-arg-class-no-optimize-weights"></span><span class="sig-name descname"><span class="pre">class_no_optimize_weights</span></span><span class="sig-prename descclassname"> <span class="pre">(character(len=90))</span></span><a class="headerlink" href="#cmdoption-arg-class_no_optimize_weights" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The classes (with the same names / numbers as in <code class="docutils literal notranslate"><span class="pre">db_file</span></code>) for which the the
optimization through genetical algorithm is no activated . If there
are many classes, theirs names should be separated by space (see
the default value for an example)
This option is active only if <code class="docutils literal notranslate"><span class="pre">optimize_weights=.true.</span></code>
Example: <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights="</span> <span class="pre">02</span> <span class="pre">06</span> <span class="pre">"</span></code> - no optimization
for the classes <code class="docutils literal notranslate"><span class="pre">02</span></code> and <code class="docutils literal notranslate"><span class="pre">06</span></code>.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">class_no_optimize_weights="</span> <span class="pre">"</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_ga_population">
<span id="cmdoption-arg-optimize-ga-population"></span><span class="sig-name descname"><span class="pre">optimize_ga_population</span></span><span class="sig-prename descclassname"> <span class="pre">(integer)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_ga_population" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The size of the population of  genetical algorithm.</p>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_ga_puplation=80</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-max_iter_optimize_weights">
<span id="cmdoption-arg-max-iter-optimize-weights"></span><span class="sig-name descname"><span class="pre">max_iter_optimize_weights</span></span><span class="sig-prename descclassname"> <span class="pre">(integer)</span></span><a class="headerlink" href="#cmdoption-arg-max_iter_optimize_weights" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The maximum number of optimization steps. The total number of optimization steps are
given by: <code class="docutils literal notranslate"><span class="pre">optimize_ga_puplation</span></code> <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">max_iter_optimize_weights</span></code></p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">max_iter_optimize_weights=40</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-factor_energy_error">
<span id="cmdoption-arg-factor-energy-error"></span><span class="sig-name descname"><span class="pre">factor_energy_error</span></span><span class="sig-prename descclassname"> <span class="pre">(real)</span></span><a class="headerlink" href="#cmdoption-arg-factor_energy_error" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The factor for energy in the
objective function <span class="math notranslate nohighlight">\(f_e\)</span> in the
Eq. <a class="reference internal" href="#equation-ga-opt">(1)</a>.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">force_energy_error=1.d0</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-factor_force_error">
<span id="cmdoption-arg-factor-force-error"></span><span class="sig-name descname"><span class="pre">factor_force_error</span></span><span class="sig-prename descclassname"> <span class="pre">(real)</span></span><a class="headerlink" href="#cmdoption-arg-factor_force_error" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The factor for force in the
objective function <span class="math notranslate nohighlight">\(f_f\)</span> in the
Eq. <a class="reference internal" href="#equation-ga-opt">(1)</a>.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">force_force_error=1.d0</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-factor_stress_error">
<span id="cmdoption-arg-factor-stress-error"></span><span class="sig-name descname"><span class="pre">factor_stress_error</span></span><span class="sig-prename descclassname"> <span class="pre">(real)</span></span><a class="headerlink" href="#cmdoption-arg-factor_stress_error" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The factor for energy in the
objective function <span class="math notranslate nohighlight">\(f_s\)</span> in the
Eq. <a class="reference internal" href="#equation-ga-opt">(1)</a>.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">force_stress_error=1.d0</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_L1">
<span id="cmdoption-arg-optimize-weights-l1"></span><span class="sig-name descname"><span class="pre">optimize_weights_L1</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_L1" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The regularization is performed
by adding a <span class="math notranslate nohighlight">\(L^1\)</span> function on the objective function from
Eq. <a class="reference internal" href="#equation-ga-opt">(1)</a> The weigths are optimized in the
same time as the <code class="docutils literal notranslate"><span class="pre">lambda_krr</span></code> regularizitation parameter. The new
objective function becomes:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = J(\mathbf{w}) + \lambda_{krr} \sum_k \left|  w_k \right|\]</div>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_L1=.false.</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_L2">
<span id="cmdoption-arg-optimize-weights-l2"></span><span class="sig-name descname"><span class="pre">optimize_weights_L2</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_L2" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The regularization is performed
by adding a <span class="math notranslate nohighlight">\(L^2\)</span> function on the objective function from
Eq. <a class="reference internal" href="#equation-ga-opt">(1)</a>. The weigths are optimized in the
same time as the <code class="docutils literal notranslate"><span class="pre">lambda_krr</span></code> regularizitation parameter. The new
objective function becomes:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = J(\mathbf{w}) + \lambda_{krr} \sum_k \left|  w_k \right|^2\]</div>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_L1=.false.</span></code></p>
</dd>
</dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-optimize_weights_Le">
<span id="cmdoption-arg-optimize-weights-le"></span><span class="sig-name descname"><span class="pre">optimize_weights_Le</span></span><span class="sig-prename descclassname"> <span class="pre">(logical)</span></span><a class="headerlink" href="#cmdoption-arg-optimize_weights_Le" title="Permalink to this definition"></a>
</dt>
<dd>
<p>The regularization is performed
by adding a <span class="math notranslate nohighlight">\(L^2\)</span> + <span class="math notranslate nohighlight">\(L^1\)</span> function on the objective
function from Eq. <a class="reference internal" href="#equation-ga-opt">(1)</a>. The weigths are
optimized in the same time as the <code class="docutils literal notranslate"><span class="pre">lambda_krr</span></code> regularizitation
parameter. The new objective function becomes:</p>
<div class="math notranslate nohighlight">
\[J(\mathbf{w}) = J(\mathbf{w}) + \lambda_{krr} \sum_k \left|  w_k \right|^2 + \lambda_{krr} \sum_k \left|  w_k \right|\]</div>
<p>Default <code class="docutils literal notranslate"><span class="pre">optimize_weights_Le=.false.</span></code></p>
</dd>
</dl>

</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="database.html" class="btn btn-neutral float-left" title="Databases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="advanced.html" class="btn btn-neutral float-right" title="Advanced options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MCM, AMG &amp; more.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>